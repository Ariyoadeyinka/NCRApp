<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Operations • Review NCR</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

    <!-- Reuse your existing styles -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/eng.css">
    <link rel="stylesheet" href="css/engtwo.css">
    <link rel="stylesheet" href="css/opps.css">
</head>

<body>

    <header class="sticky-top bg-body">
        <nav class="navbar navbar-expand-md bg-body px-2">
            <div class="container-xxl">

                <a class="navbar-brand d-flex align-items-center gap-2" href="dashboard.html"
                    aria-label="Return to dashboard">
                    <img src="images/logo.png" alt="Crossfire Logo" style="height: 50px; width: auto;">
                    <span class="brand-divider">|</span>
                    <span class="text-body-secondary small" id="pageTitle">Operations-Review</span>
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
                    aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation menu">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-end" id="mainNav">
                    <ul class="navbar-nav align-items-md-center gap-2">

                        <li class="nav-item">
                            <a class="btn btn-sm btn-outline-secondary nav-btn d-flex align-items-center gap-2"
                                href="dashboard.html" aria-label="Dashboard">
                                <i class="fa-solid fa-house" aria-hidden="true"></i> Dashboard
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="btn btn-sm btn-outline-secondary nav-btn d-flex align-items-center gap-2"
                                href="view-ncr.html" aria-label="View NCRs">
                                <i class="fa-regular fa-file-lines" aria-hidden="true"></i> View NCRs
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="btn btn-sm btn-outline-secondary nav-btn d-flex align-items-center gap-2"
                                href="create-ncr.html" aria-label="Create NCR">
                                <i class="fa-solid fa-plus" aria-hidden="true"></i> Create NCR
                            </a>
                        </li>

                        <!-- Notifications -->
                        <li class="nav-item dropdown position-relative">
                            <a class="btn btn-sm btn-outline-secondary d-flex align-items-center gap-2 position-relative dropdown-toggle"
                                href="#" id="notifMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                                aria-label="Notifications">
                                <i class="bi bi-bell" aria-hidden="true"></i>
                                <span class="visually-hidden">Notifications</span>

                                <span id="notifBadge"
                                    class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">
                                    0
                                </span>
                            </a>

                            <ul class="dropdown-menu dropdown-menu-end shadow border-0 p-0" aria-labelledby="notifMenu"
                                style="min-width: 320px;">
                                <li class="px-3 py-2 border-bottom small text-muted">
                                    Notifications
                                </li>
                                <li>
                                    <div id="notifList" class="list-group list-group-flush small">
                                        <div class="list-group-item border-0 py-3 text-muted" id="notifEmpty">
                                            No notifications.
                                        </div>
                                    </div>
                                </li>
                                <li class="border-top">
                                    <a class="dropdown-item text-center small" href="notifications.html">
                                        View all
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <!-- Account -->
                        <li class="nav-item dropdown dropdown-hover position-relative">
                            <a class="nav-link btn btn-sm btn-outline-secondary dropdown-toggle d-flex align-items-center gap-2 position-relative"
                                href="#" id="accountMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                                aria-label="Account menu">
                                <i class="bi bi-person-circle" aria-hidden="true"></i> Account
                            </a>
                            <ul class="dropdown-menu shadow border-0" aria-labelledby="accountMenu">
                                <li><a class="dropdown-item" href="#profile" data-view="profile">Profile</a></li>
                                <li><a class="dropdown-item" href="#settings" data-view="settings">Settings</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="#logout">Sign out</a></li>
                            </ul>
                        </li>

                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container-xxl py-4">

        <!-- Breadcrumb -->
        <div class="small text-muted mb-2">
            <i class="bi bi-house-door me-1"></i>
            <a href="operations-dashboard.html" class="text-muted text-decoration-none">Dashboard</a>
            <span class="mx-2">›</span>
            <a href="operations-ncrs.html" class="text-muted text-decoration-none">NCR List</a>
            <span class="mx-2">›</span>
            <strong class="text-dark">Operations Review</strong>
        </div>

        <!-- Steps (reuse eng-step styles) -->
        <div class="d-flex align-items-center gap-3 mb-3 eng-steps">
            <div class="eng-step eng-step-active" id="opsStepLabelForm">
                <span class="eng-step-dot"><i class="fa-solid fa-clipboard-check"></i></span>
                <span>Operations Section</span>
            </div>
            <div class="eng-step-line"></div>
            <div class="eng-step" id="opsStepLabelReview">
                <span class="eng-step-dot"><i class="fa-regular fa-paper-plane"></i></span>
                <span>Review &amp; Close</span>
            </div>
        </div>

        <!-- QUALITY SUMMARY (accordion style – same as engineering page) -->
        <details class="card border-0 shadow-sm mb-3 q-summary" open>
            <summary class="q-summary-head d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center gap-2">
                    <i class="fa-regular fa-clipboard"></i>
                    <span class="fw-semibold">Quality Section Summary</span>
                </div>
                <i class="fa-solid fa-chevron-down q-caret" aria-hidden="true"></i>
            </summary>

            <div class="q-summary-body">
                <div class="row g-3 small">
                    <div class="col-12">
                        <label class="form-label text-muted mb-1">NCR No</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="ncrNo" readonly>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label text-muted mb-1">Supplier Name</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="supplier" readonly>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label text-muted mb-1">Product No</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="productNo" readonly>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label text-muted mb-1">Sales Order No</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="soNo" readonly>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-muted mb-1">Date Raised</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="dateRaised" readonly>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-muted mb-1">Closed Date</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="dateClosed" readonly>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-muted mb-1">WIP PRO</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality" data-field="wip"
                            readonly>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-muted mb-1">Item Marked as Non-Conforming</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="isNc" readonly>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-muted mb-1">Quantity Supplied</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="qtySupplied" readonly>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-muted mb-1">Quantity Defective</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="qtyDefective" readonly>
                    </div>

                    <div class="col-12">
                        <label class="form-label text-muted mb-1">Defect Description</label>
                        <textarea class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="defectDesc" rows="2" readonly style="height: 160px;"></textarea>
                    </div>

                    <div class="col-12">
                        <label class="form-label text-muted mb-1">Quality Rep Name</label>
                        <input class="form-control form-control-sm disabled-form" data-source="quality"
                            data-field="repName" readonly>
                    </div>
                </div>
            </div>
        </details>

        <!-- ENGINEERING SUMMARY (second accordion) -->
        <details class="card border-0 shadow-sm mb-3 q-summary" open>
            <summary class="q-summary-head d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center gap-2">
                    <i class="fa-solid fa-wrench"></i>
                    <span class="fw-semibold">Engineering Section Summary</span>
                </div>
                <i class="fa-solid fa-chevron-down q-caret" aria-hidden="true"></i>
            </summary>

            <div class="q-summary-body">
                <div class="row g-3 small">
                    <div class="col-md-4">
                        <label class="form-label text-muted mb-1">Disposition</label>
                        <input class="form-control form-control-sm disabled-form" data-source="engineering"
                            data-field="disposition" readonly>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-muted mb-1">Customer Notification</label>
                        <input class="form-control form-control-sm disabled-form" data-source="engineering"
                            data-field="customer_notify" readonly>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-muted mb-1">Drawing Update Required</label>
                        <input class="form-control form-control-sm disabled-form" data-source="engineering"
                            data-field="drawing_update_required" readonly>
                    </div>

                    <div class="col-12">
                        <label class="form-label text-muted mb-1">Disposition Notes</label>
                        <textarea class="form-control form-control-sm disabled-form" data-source="engineering"
                            data-field="disposition_notes" rows="2" readonly></textarea>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label text-muted mb-1">Original Rev.</label>
                        <input class="form-control form-control-sm disabled-form" data-source="engineering"
                            data-field="original_rev" readonly>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-muted mb-1">Updated Rev.</label>
                        <input class="form-control form-control-sm disabled-form" data-source="engineering"
                            data-field="updated_rev" readonly>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-muted mb-1">Engineer Name</label>
                        <input class="form-control form-control-sm disabled-form" data-source="engineering"
                            data-field="engineer_name" readonly>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label text-muted mb-1">Revision Date</label>
                        <input class="form-control form-control-sm disabled-form" data-source="engineering"
                            data-field="revision_date" readonly>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-muted mb-1">Signature Date</label>
                        <input class="form-control form-control-sm disabled-form" data-source="engineering"
                            data-field="signature_date" readonly>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-muted mb-1">Engineering Signature</label>
                        <input class="form-control form-control-sm disabled-form" data-source="engineering"
                            data-field="signature" readonly>
                    </div>
                </div>
            </div>
        </details>

        <!-- OPERATIONS SECTION (Purchasing / Operations Manager inputs) -->
        <section id="opsStepForm">
            <form id="opsForm" class="card border-0 shadow-sm">
                <div class="card-header bg-white fw-semibold d-flex align-items-center gap-2">
                    <i class="fa-solid fa-clipboard-list"></i> Operations / Purchasing Section
                </div>

                <div class="card-body">
                    <p class="text-muted small mb-3">
                        Complete the operations review and disposition.
                    </p>

                    <!-- ROW 1: Purchasing decision + CAR + Follow-up -->
                    <div class="row g-3 mb-2">

                        <!-- Purchasing decision -->
                        <div class="col-lg-4">
                            <label class="form-label fw-semibold">
                                Purchasing's Preliminary Decision <span class="text-danger">*</span>
                            </label>
                            <div class="btn-group d-block d-md-inline-flex" role="group"
                                aria-label="Purchasing decision">
                                <input type="radio" class="btn-check" name="opsDecision" id="opsReturnSupplier"
                                    value="Return to Supplier" checked>
                                <label class="btn btn-outline-secondary" for="opsReturnSupplier">Return to
                                    Supplier</label>

                                <input type="radio" class="btn-check" name="opsDecision" id="opsReworkInHouse"
                                    value="Rework In-House">
                                <label class="btn btn-outline-secondary" for="opsReworkInHouse">Rework In-House</label>

                                <input type="radio" class="btn-check" name="opsDecision" id="opsScrapInHouse"
                                    value="Scrap in House">
                                <label class="btn btn-outline-secondary" for="opsScrapInHouse">Scrap in House</label>

                                <input type="radio" class="btn-check" name="opsDecision" id="opsDeferEng"
                                    value="Defer to HBC Eng. Review">
                                <label class="btn btn-outline-secondary" for="opsDeferEng">Defer to HBC Eng.
                                    Review</label>
                            </div>
                        </div>

                        <!-- CAR raised -->
                        <div class="col-lg-4">
                            <label class="form-label fw-semibold">
                                Was a CAR raised? <span class="text-danger">*</span>
                            </label>
                            <div class="btn-group d-block" role="group" aria-label="CAR raised">
                                <input type="radio" class="btn-check" name="carRaised" id="carYes" value="Yes">
                                <label class="btn btn-outline-secondary" for="carYes">Yes</label>

                                <input type="radio" class="btn-check" name="carRaised" id="carNo" value="No" checked>
                                <label class="btn btn-outline-secondary" for="carNo">No</label>
                            </div>
                            <input type="text" class="form-control mt-2 hidden-field" id="carNumber"
                                placeholder="If yes, enter CAR #">
                        </div>

                        <!-- Follow-up Required -->
                        <div class="col-lg-4">
                            <label class="form-label fw-semibold">
                                Follow-up Required? <span class="text-danger">*</span>
                            </label>

                            <div class="btn-group d-block" role="group">
                                <input type="radio" class="btn-check" name="followReq" id="followupYes" value="Yes">
                                <label class="btn btn-outline-secondary" for="followupYes">Yes</label>

                                <input type="radio" class="btn-check" name="followReq" id="followupNo" value="No"
                                    checked>
                                <label class="btn btn-outline-secondary" for="followupNo">No</label>
                            </div>

                            <!-- Follow-up details container -->
                            <div id="followupContainer" class="row g-2 mt-2 hidden-field">
                                <div class="col-md-7">
                                    <input type="text" class="form-control" id="followupType"
                                        placeholder="Enter follow-up type">
                                </div>

                                <div class="col-md-5">
                                    <input type="date" class="form-control" id="followupDate">
                                </div>
                            </div>
                        </div>

                    </div>


                    <hr class="my-3">

                    <!-- ROW 2: Re-inspected + Ops Manager + Date -->
                    <div class="row g-3 mb-2 align-items-end">
                        <!-- Re-inspected acceptable + New NCR (conditional) -->
                        <div class="col-lg-4">
                            <label class="form-label fw-semibold">
                                Re-inspected acceptable? <span class="text-danger">*</span>
                            </label>
                            <div class="btn-group d-block" role="group" aria-label="Re-inspected acceptable">
                                <input type="radio" class="btn-check" name="reinspectedAcceptable" id="reinspectYes"
                                    value="Yes" checked>
                                <label class="btn btn-outline-secondary" for="reinspectYes">Yes</label>

                                <input type="radio" class="btn-check" name="reinspectedAcceptable" id="reinspectNo"
                                    value="No">
                                <label class="btn btn-outline-secondary" for="reinspectNo">No</label>
                            </div>

                            <!-- Shown only when "No" is selected -->
                            <div id="newNcrGroup" class="mt-2 d-none">
                                <label class="form-label mb-1 small">New NCR Number (if not acceptable)</label>
                                <input type="text" class="form-control" id="newNcrNumber" placeholder="New NCR Number">
                            </div>
                        </div>

                        <!-- Ops Manager -->
                        <div class="col-lg-4">
                            <label class="form-label fw-semibold">Operations Manager</label>
                            <input type="text" class="form-control" id="opsManager" placeholder="Name">
                        </div>

                        <!-- Ops Manager Date -->
                        <div class="col-lg-4">
                            <label class="form-label fw-semibold">Date</label>
                            <input type="date" class="form-control" id="opsDate">
                        </div>
                    </div>

                    <hr class="my-3">

                    <!-- ROW 3: Remaining fields -->
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">Inspector's Name</label>
                            <input type="text" class="form-control" id="inspectorName" placeholder="Name">
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="inspectorDate">
                        </div>

                        <div class="col-md-3 d-flex align-items-center">
                            <div class="form-check mt-3 mt-md-4">
                                <input class="form-check-input" type="checkbox" id="ncrClosed">
                                <label class="form-check-label fw-semibold" for="ncrClosed">
                                    NCR Closed
                                </label>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Quality Dept. Date</label>
                            <input type="date" class="form-control" id="qualityDeptDate">
                        </div>
                    </div>
                </div>

                <div class="card-footer bg-white d-flex flex-column flex-md-row gap-2 justify-content-between">
                    <div class="d-flex gap-2">
                        <a href="operations-ncrs.html" class="btn btn-outline-secondary">
                            <i class="fa-solid fa-arrow-left-long me-1"></i> Back
                        </a>
                        <button type="button" class="btn btn-save" id="opsBtnSave">
                            <i class="fa-solid fa-floppy-disk me-1"></i> Save
                        </button>
                        <a href="operations-ncrs.html" class="btn btn-light">Cancel</a>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-primary" id="opsBtnGoReview">
                            Review &amp; Submit <i class="fa-solid fa-arrow-right-long ms-1"></i>
                        </button>
                    </div>
                </div>
            </form>
        </section>



        <!-- You can add an operations review summary section similar to Engineering's "Review & Submit"
         if you want a second step. For now it's just the form step. -->

        <!-- Confirm modal -->
        <div class="modal fade" id="cfConfirmModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id="cfConfirmTitle" class="modal-title">Please confirm</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div id="cfConfirmBody" class="modal-body">Are you sure?</div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button id="cfConfirmYesBtn" type="button" class="btn btn-primary">Yes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success modal -->
        <div class="modal fade" id="cfSuccessModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id="cfSuccessTitle" class="modal-title">Success</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div id="cfSuccessBody" class="modal-body">Done.</div>
                    <div class="modal-footer">
                        <button id="cfSuccessOkBtn" type="button" class="btn btn-primary"
                            data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fail modal -->
        <div class="modal fade" id="cfFailModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-danger">
                    <div class="modal-header">
                        <h5 id="cfFailTitle" class="modal-title text-danger">Action failed</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div id="cfFailBody" class="modal-body">Something went wrong.</div>
                    <div class="modal-footer">
                        <button id="cfFailOkBtn" type="button" class="btn btn-danger"
                            data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="app-footer">
        <div class="footer-left">
            <img src="images/logo.png" alt="Crossfire Logo" style="height:50px">
            NCR Management System – Built with accessibility in mind
        </div>
        <div class="footer-right">
            Keyboard shortcuts: <span class="shortcut">Alt+H</span> (Home),
            <span class="shortcut">Alt+L</span> (List),
            <span class="shortcut">Alt+N</span> (New)
        </div>
    </footer>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="js/login.js"></script>
    <script src="js/nav-notifications.js"></script>
    <script src="js/ncr-notify.js"></script>

    <!-- New JS you’ll wire up similar to engineering-review.js -->
    <script src="js/operations-review.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Elements
            const carYes = document.getElementById("carYes");
            const carNo = document.getElementById("carNo");
            const carInput = document.getElementById("carNumber");

            const followYes = document.getElementById("followupYes");
            const followNo = document.getElementById("followupNo");
            const followContainer = document.getElementById("followupContainer");
            const followType = document.getElementById("followupType");
            const followDate = document.getElementById("followupDate");

            const reinspectYes = document.getElementById("reinspectYes");
            const reinspectNo = document.getElementById("reinspectNo");
            const newNcrGroup = document.getElementById("newNcrGroup");
            const newNcrNumber = document.getElementById("newNcrNumber");

            // Functions
            function updateCarField() {
                if (carYes.checked) {
                    carInput.classList.remove("hidden-field");
                } else {
                    carInput.classList.add("hidden-field");
                    carInput.value = "";
                }
            }

            function updateNewNcrField() {
                if (reinspectNo.checked) {
                    newNcrGroup.classList.remove("d-none");
                } else {
                    newNcrGroup.classList.add("d-none");
                    newNcrNumber.value = "";
                }
            }

            function updateFollowDetails() {
                if (followYes.checked) {
                    followContainer.classList.remove("hidden-field");
                } else {
                    followContainer.classList.add("hidden-field");
                    followType.value = "";
                    followDate.value = "";
                }
            }

            // Event listeners
            carYes.addEventListener("change", updateCarField);
            carNo.addEventListener("change", updateCarField);


            followYes.addEventListener("change", updateFollowDetails);
            followNo.addEventListener("change", updateFollowDetails);
            reinspectYes.addEventListener("change", updateNewNcrField);
            reinspectNo.addEventListener("change", updateNewNcrField);

            // Initial load
            updateCarField();
            updateFollowDetails();
            updateNewNcrField();
        });
    </script>
<script src="js/operation-review.js"></script>
</body>

</html>